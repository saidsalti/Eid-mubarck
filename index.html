<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>عيد الفطر المبارك</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/addons/p5.sound.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Amiri', 'Scheherazade New', serif;
            background-color: #0a1931;
        }
        canvas {
            display: block;
        }
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap');
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
            color: #ffd700;
            z-index: 10;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            animation: pulse 3s infinite;
            padding: 0 15px; /* Add padding for small screens */
        }
        h1 {
            font-size: calc(2rem + 3vmin); /* Responsive font size */
            margin-bottom: 1rem;
        }
        h2 {
            font-size: calc(1rem + 1.5vmin); /* Responsive font size */
            font-weight: normal;
            margin-bottom: 1.5rem;
            color: #f8f9fa;
        }
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .cube-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(320px, 90vw); /* Responsive width */
            height: min(320px, 90vw); /* Responsive height */
            perspective: 1200px;
            z-index: 20;
            filter: drop-shadow(0 0 35px rgba(255, 215, 0, 0.5));
        }
        
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: translateZ(-160px);
            animation: floatCube 15s ease-in-out infinite;
        }
        
        @keyframes floatCube {
            0% { transform: translateZ(-160px) rotateY(0deg) rotateX(10deg) translateY(0px); }
            25% { transform: translateZ(-160px) rotateY(90deg) rotateX(-5deg) translateY(-10px); }
            50% { transform: translateZ(-160px) rotateY(180deg) rotateX(10deg) translateY(0px); }
            75% { transform: translateZ(-160px) rotateY(270deg) rotateX(-5deg) translateY(-10px); }
            100% { transform: translateZ(-160px) rotateY(360deg) rotateX(10deg) translateY(0px); }
        }
        
        .cube-face {
            position: absolute;
            width: min(320px, 90vw); /* Match container size */
            height: min(320px, 90vw); /* Match container size */
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle, rgba(30, 40, 100, 0.9) 0%, rgba(10, 20, 60, 0.95) 70%);
            border: 5px solid;
            border-image: linear-gradient(45deg, #ffd700, #ffcc00, #ffaa00, #ffd700) 1;
            color: white;
            font-family: 'Amiri', 'Scheherazade New', serif;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            overflow: hidden;
        }
        
        .cube-face::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('./images/islamic-pattern.png') center/cover;
            opacity: 0.15;
            z-index: -1;
        }
        
        .cube-face::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
            z-index: -1;
            animation: rotateGlow 20s linear infinite;
        }
        
        @keyframes rotateGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .front { transform: rotateY(0deg) translateZ(min(160px, 45vw)); }
        .back { transform: rotateY(180deg) translateZ(min(160px, 45vw)); }
        .right { transform: rotateY(90deg) translateZ(min(160px, 45vw)); }
        .left { transform: rotateY(-90deg) translateZ(min(160px, 45vw)); }
        .top { transform: rotateX(90deg) translateZ(min(160px, 45vw)); }
        .bottom { transform: rotateX(-90deg) translateZ(min(160px, 45vw)); }
        
        .cube-face h3 {
            margin: 0 0 15px 0;
            font-size: calc(1.5rem + 1vmin); /* Responsive font size */
            background: linear-gradient(to right, #fff, gold, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 6s linear infinite;
            text-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
            position: relative;
        }
        
        @keyframes shineText {
            0% { background-position: -500px 0; }
            100% { background-position: 500px 0; }
        }
        
        .cube-face p {
            margin: 5px 0;
            font-size: calc(0.9rem + 0.5vmin); /* Responsive font size */
            line-height: 1.5;
            color: #ffffff;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 2;
        }
        
        /* Corner decorations */
        .cube-face .corner {
            position: absolute;
            width: min(50px, 15vw);
            height: min(50px, 15vw);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><path d="M0,0 L50,0 L50,10 C40,10 10,40 10,50 L0,50 Z" fill="gold"/></svg>');
            opacity: 0.8;
            filter: drop-shadow(0 0 5px gold);
        }
        
        .cube-face .corner-tl { top: 0; left: 0; }
        .cube-face .corner-tr { top: 0; right: 0; transform: rotate(90deg); }
        .cube-face .corner-bl { bottom: 0; left: 0; transform: rotate(270deg); }
        .cube-face .corner-br { bottom: 0; right: 0; transform: rotate(180deg); }
        
        /* Light rays effect */
        .light-rays {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            transform: translate(-50%, -50%);
            background: radial-gradient(ellipse, rgba(255, 215, 0, 0.4) 0%, transparent 70%);
            z-index: 1;
            mix-blend-mode: screen;
            animation: pulse-rays 6s ease-in-out infinite alternate;
        }
        
        @keyframes pulse-rays {
            0% { opacity: 0.4; width: 450px; height: 450px; }
            100% { opacity: 0.7; width: 550px; height: 550px; }
        }
        
        /* Islamic pattern frame */
        .islamic-frame {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(255, 215, 0, 0.6);
            z-index: 2;
            pointer-events: none;
        }
        
        .islamic-frame::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            z-index: 1;
        }
        
        /* Arabesque decorations */
        .arabesque {
            position: absolute;
            width: min(30px, 10vw);
            height: min(30px, 10vw);
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.7;
        }
        
        .arabesque-1 {
            top: 50px;
            left: 20px;
            transform: rotate(45deg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M15,0 C20,10 30,15 15,30 C0,15 10,10 15,0" stroke="gold" fill="none" stroke-width="1" /></svg>');
        }
        
        .arabesque-2 {
            top: 50px;
            right: 20px;
            transform: rotate(-45deg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M15,0 C20,10 30,15 15,30 C0,15 10,10 15,0" stroke="gold" fill="none" stroke-width="1" /></svg>');
        }
        
        .arabesque-3 {
            bottom: 50px;
            left: 20px;
            transform: rotate(-45deg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M15,0 C20,10 30,15 15,30 C0,15 10,10 15,0" stroke="gold" fill="none" stroke-width="1" /></svg>');
        }
        
        .arabesque-4 {
            bottom: 50px;
            right: 20px;
            transform: rotate(45deg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M15,0 C20,10 30,15 15,30 C0,15 10,10 15,0" stroke="gold" fill="none" stroke-width="1" /></svg>');
        }
        
        /* Floating mosque silhouettes */
        .mosque-silhouette {
            position: absolute;
            bottom: 5%;
            width: 100%;
            height: 150px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 200"><path d="M0,200 L50,200 L60,180 L70,200 L80,180 L90,200 L100,180 L110,200 L120,180 L130,200 L140,150 C140,150 160,130 180,150 C200,170 220,130 240,150 C260,170 250,120 280,130 L300,110 L310,130 L320,100 L340,130 L350,100 L360,130 L380,90 C380,90 400,70 410,90 L420,70 L430,90 L500,70 C500,70 520,60 540,70 L550,60 L560,80 L570,60 L580,80 L590,60 L600,80 L610,60 L620,80 L700,60 L720,100 L740,60 L760,100 L800,60 L830,100 L860,60 L900,100 L930,60 L950,100 L1000,80 L1000,200 Z" fill="rgba(10,20,60,0.8)" /></svg>');
            background-size: cover;
            background-position: bottom center;
            z-index: 5;
            opacity: 0.7;
        }
        
        /* Media queries for different screen sizes */
        @media (max-width: 768px) {
            .mosque-silhouette {
                height: 100px; /* Smaller on mobile */
            }
            
            .light-rays {
                width: 350px;
                height: 350px;
            }
            
            @keyframes pulse-rays {
                0% { opacity: 0.4; width: 300px; height: 300px; }
                100% { opacity: 0.7; width: 350px; height: 350px; }
            }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) {
            .cube-face {
                border-width: 4px; /* Slightly thinner borders on touch devices */
            }
        }
    </style>
</head>
<body>
    <div class="message">
        <h1>عيد فطر مبارك</h1>
        <h2>تقبل الله صيامكم وقيامكم<br>وكل عام وأنتم بخير</h2>
    </div>
    
    <!-- Add light rays effect -->
    <div class="light-rays"></div>
    
    <!-- Add mosque silhouette -->
    <div class="mosque-silhouette"></div>
    
    <div class="cube-container">
        <div class="cube">
            <div class="cube-face front">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>نتمنى لكم عيداً مليئاً بالسعادة والبركات</p>
                <p>وأيامٍ مشرقة بنور الإيمان والمحبة</p>
                <p>وكل عام وأنتم بألف خير</p>
                <p>تقبل الله منا ومنكم صالح الأعمال</p>
                <p>عيد فطر مبارك</p>
            </div>
            <div class="cube-face back">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>في هذا اليوم المبارك نسأل الله</p>
                <p>أن يمن علينا وعليكم بالصحة والعافية</p>
                <p>وأن يجعل أيامنا كلها سعادة وفرح</p>
                <p>وأن يتقبل منا الصيام والقيام</p>
                <p>عيد فطر مبارك</p>
            </div>
            <div class="cube-face right">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>مع إشراقة عيد الفطر المبارك</p>
                <p>نرسل أجمل التهاني والتبريكات</p>
                <p>متمنين لكم عيداً سعيداً</p>
                <p>وحياة مليئة بالخير والبركة</p>
                <p>عيد فطر مبارك</p>
            </div>
            <div class="cube-face left">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>بعد شهر من الصيام والعبادة</p>
                <p>نستقبل العيد بفرحة وسرور</p>
                <p>ونسأل الله أن يتقبل منا ومنكم</p>
                <p>ويجمعنا دائماً على الخير والمحبة</p>
                <p>عيد فطر مبارك</p>
            </div>
            <div class="cube-face top">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>أهديكم أجمل عبارات التهنئة</p>
                <p>بمناسبة حلول عيد الفطر المبارك</p>
                <p>وأسأل الله أن يديم عليكم فرحة العيد</p>
                <p>وأن يبارك لكم في أيامكم القادمة</p>
                <p>عيد فطر مبارك</p>
            </div>
            <div class="cube-face bottom">
                <div class="islamic-frame"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <div class="arabesque arabesque-1"></div>
                <div class="arabesque arabesque-2"></div>
                <div class="arabesque arabesque-3"></div>
                <div class="arabesque arabesque-4"></div>
                <h3>سعيد بن يعقوب الصلتي</h3>
                <p>مع إطلالة عيد الفطر المبارك</p>
                <p>نسأل الله أن يجعل أيامنا كلها أعياد</p>
                <p>وأن يمن علينا بالأمن والسلام</p>
                <p>وأن يجمعنا دائماً على طاعته</p>
                <p>عيد فطر مبارك</p>
            </div>
        </div>
    </div>

    <script>
        let stars = [];
        let lanterns = [];
        let moons = [];
        let fireworks = [];
        let particles = [];
        let crescentImg;
        let lanternImg;
        let confetti = [];
        let backgroundImg;
        let surroundingFireworks = []; // For fireworks surrounding the cube
        let imageLoadError = false;

        function preload() {
            // Add error handling for image loading
            try {
                crescentImg = loadImage('https://i.ibb.co/QbqStvq/crescent.png', 
                    () => console.log('Crescent loaded successfully'), 
                    () => { console.error('Failed to load crescent'); imageLoadError = true; }
                );
                
                lanternImg = loadImage('https://i.ibb.co/0MmB3HF/lantern.png', 
                    () => console.log('Lantern loaded successfully'), 
                    () => { console.error('Failed to load lantern'); imageLoadError = true; }
                );
                
                // Try with relative path first
                try {
                    backgroundImg = loadImage('./images/masjed.webp', 
                        () => console.log('Background loaded successfully'), 
                        () => {
                            console.error('Failed to load background with relative path');
                            // Try with absolute path as fallback
                            try {
                                backgroundImg = loadImage('c:/Users/firis/Desktop/temps/Eid mubarck/images/masjed.webp',
                                    () => console.log('Background loaded with absolute path'),
                                    () => { console.error('Failed to load background with absolute path'); imageLoadError = true; }
                                );
                            } catch (e) {
                                console.error('Error loading background with absolute path:', e);
                                imageLoadError = true;
                            }
                        }
                    );
                } catch (e) {
                    console.error('Error loading background with relative path:', e);
                    imageLoadError = true;
                }
            } catch (e) {
                console.error('Error in preload:', e);
                imageLoadError = true;
            }
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            
            // If there was an image loading error, show a message
            if (imageLoadError) {
                console.warn('Some images failed to load. Using fallback styles.');
            }
            
            // Enhanced twinkling stars
            for (let i = 0; i < 120; i++) {
                stars.push({
                    x: random(width),
                    y: random(height),
                    size: random(1, 4),
                    twinkleSpeed: random(0.03, 0.08), // Faster twinkling
                    brightness: random(150, 255), // Brighter stars
                    twinkleAmount: random(50, 100) // More pronounced twinkling
                });
            }
            
            // Create only ONE moon - make it prominent
            moons = [{
                x: width * 0.85, // Position it on the right side
                y: height * 0.2, // Position it high in the sky
                size: random(60, 80), // Make it larger
                rotation: random(TWO_PI),
                rotationSpeed: 0.002 // Slow, subtle rotation
            }];
            
            for (let i = 0; i < 8; i++) {
                lanterns.push({
                    x: random(width),
                    y: random(height * 0.3, height * 0.8),
                    size: random(30, 70),
                    speedY: random(-0.3, 0.3),
                    speedX: random(-0.2, 0.2),
                    angle: 0,
                    angleSpeed: random(-0.01, 0.01)
                });
            }
            
            for (let i = 0; i < 100; i++) {
                confetti.push({
                    x: random(width),
                    y: random(-100, -10),
                    size: random(5, 10),
                    color: color(random(100, 255), random(100, 255), random(100, 255)),
                    speedY: random(1, 3),
                    speedX: random(-1, 1),
                    rotation: random(TWO_PI),
                    rotSpeed: random(-0.1, 0.1)
                });
            }
            
            // Create surrounding fireworks points (in a circle around the center)
            let centerX = windowWidth / 2;
            let centerY = windowHeight / 2;
            let radius = min(200, windowWidth * 0.25); // Responsive radius
            
            for (let angle = 0; angle < TWO_PI; angle += PI/8) {
                let x = centerX + cos(angle) * radius;
                let y = centerY + sin(angle) * radius;
                surroundingFireworks.push({
                    x: x,
                    y: y,
                    lastFired: random(0, 100),
                    fireRate: random(100, 200)
                });
            }

            // Adjust number of particles for mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const orbitParticleCount = isMobile ? 75 : 150;
            const patternCount = isMobile ? 6 : 12;

            // Create particle system around the cube
            for (let i = 0; i < orbitParticleCount; i++) {
                particles.push({
                    x: width/2 + random(-200, 200),
                    y: height/2 + random(-200, 200),
                    size: random(2, 5),
                    speedX: random(-0.5, 0.5),
                    speedY: random(-0.5, 0.5),
                    hue: random(30, 60), // Gold-like colors
                    alpha: random(100, 200),
                    orbitRadius: random(150, 250),
                    orbitSpeed: random(0.01, 0.03),
                    orbitAngle: random(TWO_PI),
                    type: 'orbit'
                });
            }

            // Create special moon phase particles
            for (let i = 0; i < 15; i++) {
                particles.push({
                    x: random(width),
                    y: random(height),
                    size: random(25, 40),
                    phase: random(TWO_PI),
                    phaseSpeed: random(0.005, 0.02),
                    alpha: random(100, 180),
                    type: 'moonPhase'
                });
            }
            
            // Create particles that form Islamic pattern shapes
            let patterns = [
                // Star pattern
                (angle) => { return 1 + 0.4 * cos(angle * 8); },
                // Crescent shape
                (angle) => { return 1 + 0.5 * sin(angle) * cos(angle); },
                // Hexagon
                (angle) => { return 1 + 0.2 * cos(angle * 6); }
            ];
            
            for (let i = 0; i < patternCount; i++) {
                let patternType = floor(random(patterns.length));
                let hue = random([38, 45, 50]); // Gold-ish hues
                let centroidX = random(width);
                let centroidY = random(height);
                
                for (let angle = 0; angle < TWO_PI; angle += TWO_PI/30) {
                    let r = random(60, 100) * patterns[patternType](angle);
                    let x = centroidX + cos(angle) * r;
                    let y = centroidY + sin(angle) * r;
                    
                    if (x > 0 && x < width && y > 0 && y < height) {
                        particles.push({
                            x: x,
                            y: y,
                            origX: x,
                            origY: y,
                            size: random(2, 4),
                            angle: angle,
                            radius: r,
                            radiusVariation: random(5, 15),
                            radiusSpeed: random(0.01, 0.05),
                            centroidX: centroidX,
                            centroidY: centroidY,
                            hue: hue,
                            alpha: random(150, 220),
                            type: 'islamicPattern'
                        });
                    }
                }
            }
        }

        function draw() {
            // Modify background rendering to handle missing image
            if (backgroundImg && !imageLoadError) {
                background(10, 25, 49, 100);
                imageMode(CORNER);
                tint(255, 150);
                image(backgroundImg, 0, 0, width, height);
                noTint();
            } else {
                // Fallback to gradient background if image failed to load
                let c1 = color(10, 25, 49);
                let c2 = color(20, 40, 80);
                for (let y = 0; y < height; y++) {
                    let inter = map(y, 0, height, 0, 1);
                    let c = lerpColor(c1, c2, inter);
                    stroke(c);
                    line(0, y, width, y);
                }
            }
            
            // Enhanced star twinkling effect
            for (let star of stars) {
                let brightness = star.brightness + star.twinkleAmount * sin(frameCount * star.twinkleSpeed);
                fill(brightness);
                noStroke();
                
                // Add a subtle glow effect
                if (brightness > 220) {
                    fill(brightness, brightness, 200, 50);
                    ellipse(star.x, star.y, star.size * 2.5);
                    fill(brightness);
                }
                
                ellipse(star.x, star.y, star.size);
            }
            
            // Draw the single moon with a more prominent glow
            for (let moon of moons) {
                push();
                translate(moon.x, moon.y);
                rotate(moon.rotation);
                
                // Add a subtle glow around the moon
                for (let i = 3; i > 0; i--) {
                    fill(255, 255, 220, 20);
                    ellipse(0, 0, moon.size * (1 + i * 0.4));
                }
                
                if (crescentImg && !imageLoadError) {
                    imageMode(CENTER);
                    tint(255, 255);
                    image(crescentImg, 0, 0, moon.size, moon.size);
                } else {
                    // Fallback crescent drawing if image isn't available
                    noStroke();
                    fill(255, 255, 200, 250);
                    ellipse(0, 0, moon.size);
                    fill(10, 25, 49);
                    ellipse(moon.size * 0.2, 0, moon.size * 0.8, moon.size * 0.8);
                }
                
                pop();
                
                moon.rotation += moon.rotationSpeed;
            }
            
            updateFireworks();
            updateConfetti();
            updateSurroundingFireworks();
            
            if (frameCount % 5 === 0) {
                drawGlowParticles();
            }
            
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Only create new fireworks occasionally on mobile to avoid performance issues
            if (random(1) < (isMobile ? 0.02 : 0.05)) {
                let x = random(width);
                let y = height;
                let hue = random(360);
                let firework = {
                    x: x,
                    y: y,
                    targetY: random(height * 0.1, height * 0.5),
                    speedY: random(-11, -15),
                    hue: hue,
                    size: random(3, 5),
                    explosionSize: random(100, 200)
                };
                fireworks.push(firework);
            }

            // Draw orbiting particles around the cube
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                
                if (p.type === 'orbit') {
                    // Update orbit position
                    p.orbitAngle += p.orbitSpeed;
                    p.x = width/2 + cos(p.orbitAngle) * p.orbitRadius;
                    p.y = height/2 + sin(p.orbitAngle) * p.orbitRadius * 0.6;
                    
                    // Draw the particle
                    colorMode(HSB);
                    noStroke();
                    fill(p.hue, 100, 100, p.alpha/255);
                    ellipse(p.x, p.y, p.size);
                    
                    // Add a slight trail
                    fill(p.hue, 100, 100, (p.alpha/255) * 0.3);
                    ellipse(p.x - p.speedX*3, p.y - p.speedY*3, p.size*0.7);
                    colorMode(RGB);
                }
                
                if (p.type === 'moonPhase') {
                    p.phase += p.phaseSpeed;
                    
                    // Draw moon phase
                    push();
                    translate(p.x, p.y);
                    
                    // Full circle for the moon
                    fill(255, 253, 230, p.alpha);
                    noStroke();
                    ellipse(0, 0, p.size);
                    
                    // Shadow part that creates the phase
                    let shadowOffset = cos(p.phase) * p.size * 0.6;
                    fill(10, 20, 60, p.alpha);
                    ellipse(shadowOffset, 0, p.size);
                    
                    pop();
                    
                    // Move moon slowly across the screen
                    p.x += 0.2;
                    if (p.x > width + p.size) {
                        p.x = -p.size;
                        p.y = random(height);
                    }
                }
                
                if (p.type === 'islamicPattern') {
                    let radiusVariation = sin(frameCount * p.radiusSpeed) * p.radiusVariation;
                    let newRadius = p.radius + radiusVariation;
                    p.x = p.centroidX + cos(p.angle) * newRadius;
                    p.y = p.centroidY + sin(p.angle) * newRadius;
                    
                    colorMode(HSB);
                    fill(p.hue, 80, 100, p.alpha / 255);
                    noStroke();
                    ellipse(p.x, p.y, p.size);
                    colorMode(RGB);
                }
            }
        }

        function updateFireworks() {
            for (let i = fireworks.length - 1; i >= 0; i--) {
                let firework = fireworks[i];
                firework.y += firework.speedY;
                firework.speedY += 0.2;
                
                colorMode(HSB);
                stroke(firework.hue, 100, 100);
                strokeWeight(4);
                point(firework.x, firework.y);
                colorMode(RGB);
                
                if (firework.speedY >= 0) {
                    if (typeof AudioContext !== "undefined") {
                        try {
                            let audio = new AudioContext();
                            let osc = audio.createOscillator();
                            let gain = audio.createGain();
                            osc.connect(gain);
                            gain.connect(audio.destination);
                            osc.frequency.value = random(200, 500);
                            gain.gain.value = 0.1;
                            osc.start();
                            gain.gain.exponentialRampToValueAtTime(0.00001, audio.currentTime + 0.5);
                            osc.stop(audio.currentTime + 0.5);
                        } catch(e) {
                            console.log("Audio not supported");
                        }
                    }
                    
                    let explosionType = floor(random(3));
                    let explosionParticleCount = firework.explosionSize || 100;
                    
                    for (let j = 0; j < explosionParticleCount; j++) {
                        let angle, speed;
                        
                        if (explosionType === 0) {
                            angle = random(TWO_PI);
                            speed = random(1, 5);
                        } else if (explosionType === 1) {
                            angle = random(TWO_PI);
                            let heartShape = 1 - sin(angle) * cos(angle) / 1.5;
                            speed = random(1, 4) * heartShape;
                        } else {
                            angle = random(TWO_PI);
                            let points = 5;
                            let starShape = 1 + cos(angle * points) * 0.5;
                            speed = random(1, 4) * starShape;
                        }
                        
                        let particle = {
                            x: firework.x,
                            y: firework.y,
                            vx: cos(angle) * speed,
                            vy: sin(angle) * speed,
                            hue: firework.hue,
                            alpha: 255,
                            size: random(2, 5),
                            gravity: 0.1,
                            trail: []
                        };
                        particles.push(particle);
                    }
                    
                    fireworks.splice(i, 1);
                }
            }
            
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += p.gravity;
                p.alpha -= 2;
                
                if (frameCount % 2 === 0) {
                    p.trail.push({x: p.x, y: p.y, alpha: p.alpha});
                }
                if (p.trail.length > 5) p.trail.shift();
                
                for (let j = 0; j < p.trail.length; j++) {
                    let t = p.trail[j];
                    let trailAlpha = t.alpha * 0.3;
                    colorMode(HSB);
                    noStroke();
                    fill(p.hue, 100, 100, trailAlpha / 255);
                    ellipse(t.x, t.y, p.size * 0.7);
                }
                
                if (p.alpha > 0) {
                    colorMode(HSB);
                    noStroke();
                    fill(p.hue, 100, 100, p.alpha / 255);
                    ellipse(p.x, p.y, p.size);
                    colorMode(RGB);
                } else {
                    particles.splice(i, 1);
                }
            }
        }
        
        function updateConfetti() {
            for (let i = 0; i < confetti.length; i++) {
                let c = confetti[i];
                
                c.y += c.speedY;
                c.x += c.speedX;
                c.rotation += c.rotSpeed;
                
                push();
                translate(c.x, c.y);
                rotate(c.rotation);
                fill(c.color);
                noStroke();
                rect(0, 0, c.size, c.size / 2);
                pop();
                
                if (c.y > height) {
                    c.y = random(-100, -10);
                    c.x = random(width);
                }
            }
        }

        function drawGlowParticles() {
            for (let i = 0; i < 3; i++) {
                let x = random(width);
                let y = random(height);
                
                noStroke();
                for (let j = 15; j > 0; j--) {
                    let alpha = map(j, 0, 15, 0, 50);
                    fill(255, 223, 0, alpha);
                    ellipse(x, y, j * 2);
                }
            }
        }

        function updateSurroundingFireworks() {
            for (let point of surroundingFireworks) {
                point.lastFired++;
                
                if (point.lastFired > point.fireRate) {
                    point.lastFired = 0;
                    point.fireRate = random(100, 300);
                    
                    let hue = random(360);
                    let firework = {
                        x: point.x,
                        y: point.y,
                        vx: random(-1, 1) * 2,
                        vy: random(-3, -1),
                        hue: hue,
                        size: random(2, 4),
                        explosionSize: random(50, 100),
                        gravity: 0.05,
                        alpha: 255,
                        trail: [],
                        isPeripheral: true
                    };
                    
                    particles.push(firework);
                }
            }
            
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                
                if (p.isPeripheral) {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += p.gravity;
                    p.alpha -= 1;
                    
                    if (frameCount % 2 === 0) {
                        p.trail.push({x: p.x, y: p.y, alpha: p.alpha});
                    }
                    if (p.trail.length > 5) p.trail.shift();
                    
                    for (let j = 0; j < p.trail.length; j++) {
                        let t = p.trail[j];
                        let trailAlpha = t.alpha * 0.3;
                        colorMode(HSB);
                        noStroke();
                        fill(p.hue, 100, 100, trailAlpha / 255);
                        ellipse(t.x, t.y, p.size * 0.7);
                    }
                    
                    colorMode(HSB);
                    noStroke();
                    fill(p.hue, 100, 100, p.alpha / 255);
                    ellipse(p.x, p.y, p.size);
                    colorMode(RGB);
                    
                    if (p.vy > 0 || random(1) < 0.03) {
                        createPeripheralExplosion(p.x, p.y, p.hue);
                        particles.splice(i, 1);
                    }
                    
                    if (p.alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }
            }
        }

        function createPeripheralExplosion(x, y, hue) {
            let particleCount = floor(random(20, 40));
            
            for (let i = 0; i < particleCount; i++) {
                let angle = random(TWO_PI);
                let speed = random(0.5, 2);
                
                let particle = {
                    x: x,
                    y: y,
                    vx: cos(angle) * speed,
                    vy: sin(angle) * speed,
                    hue: hue,
                    alpha: 255,
                    size: random(1, 3),
                    gravity: 0.05,
                    trail: []
                };
                
                particles.push(particle);
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            
            // Reposition moon when window is resized
            if (moons.length > 0) {
                moons[0].x = width * 0.85;
                moons[0].y = height * 0.2;
            }
        }
        
        function mousePressed() {
            let count = floor(random(3, 6));
            for (let i = 0; i < count; i++) {
                let offsetX = random(-50, 50);
                let firework = {
                    x: mouseX + offsetX,
                    y: height,
                    targetY: random(height * 0.1, height * 0.5),
                    speedY: random(-11, -15),
                    hue: random(360),
                    size: random(3, 5),
                    explosionSize: random(150, 250)
                };
                fireworks.push(firework);
            }
            return false;
        }
        
        // Add touch events for mobile
        function touchStarted() {
            // Same as mousePressed for mobile devices
            mousePressed();
            return false; // Prevent default
        }
    </script>
</body>
</html>